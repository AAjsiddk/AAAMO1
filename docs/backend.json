{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Smart Personal World application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "username": {
          "type": "string",
          "description": "The user's username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "theme": {
          "type": "string",
          "description": "The user's preferred theme (e.g., day, night)."
        },
        "accentColor": {
          "type": "string",
          "description": "The user's preferred accent color."
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "File": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "File",
      "type": "object",
      "description": "Represents a file stored in the centralized storage.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the file entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns the file. (Relationship: User 1:N File)"
        },
        "filename": {
          "type": "string",
          "description": "The original filename."
        },
        "storagePath": {
          "type": "string",
          "description": "The path to the file in the centralized storage."
        },
        "uploadDate": {
          "type": "string",
          "description": "The date and time when the file was uploaded.",
          "format": "date-time"
        },
        "fileType": {
          "type": "string",
          "description": "The type of file uploaded"
        }
      },
      "required": [
        "id",
        "userId",
        "filename",
        "storagePath",
        "uploadDate"
      ]
    },
    "AuditLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AuditLog",
      "type": "object",
      "description": "Represents a log entry for a data modification.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the audit log entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who made the change. (Relationship: User 1:N AuditLog)"
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time of the modification.",
          "format": "date-time"
        },
        "deviceId": {
          "type": "string",
          "description": "The ID of the device used to make the modification."
        },
        "entityType": {
          "type": "string",
          "description": "The type of entity that was modified (e.g., User, File)."
        },
        "entityId": {
          "type": "string",
          "description": "The ID of the entity that was modified."
        },
        "changeType": {
          "type": "string",
          "description": "The type of change that was made (e.g., create, update, delete)."
        },
        "oldValue": {
          "type": "string",
          "description": "The value of the field before the change."
        },
        "newValue": {
          "type": "string",
          "description": "The value of the field after the change."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "deviceId",
        "entityType",
        "entityId",
        "changeType"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Each user has a unique ID.  The userId is used for path-based ownership for data isolation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/files/{fileId}",
        "definition": {
          "entityName": "File",
          "schema": {
            "$ref": "#/backend/entities/File"
          },
          "description": "Stores files uploaded by each user. The userId is used for path-based ownership for data isolation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "fileId",
              "description": "The unique identifier for the file."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/audit_logs/{auditLogId}",
        "definition": {
          "entityName": "AuditLog",
          "schema": {
            "$ref": "#/backend/entities/AuditLog"
          },
          "description": "Stores audit logs for each user. The userId is used for path-based ownership for data isolation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "auditLogId",
              "description": "The unique identifier for the audit log entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure data isolation, audit logging, and centralized storage as per the application's requirements.  User data is isolated using path-based ownership (`/users/{userId}`).  File and AuditLog entities are structured as subcollections under each user, reinforcing this isolation and making security rules straightforward. This structure leverages Authorization Independence via denormalization by storing authorization context directly within documents, avoiding the need for `get()` calls in security rules. The path-based ownership model also inherently supports secure `list` operations (QAPs), as a user can only list resources under their own user ID."
  }
}